#!/usr/bin/env node
const AWS = require('aws-sdk');
AWS.config.region = 'eu-west-1';
const {
  DynamoDBClient,
  PutItemCommand,
  TransactWriteItemsCommand,
} = require('@aws-sdk/client-dynamodb');
const { marshall } = require('@aws-sdk/util-dynamodb');

const createdDateTime = new Date().toISOString();
const updatedDateTime = new Date().toISOString();

const customers = [
  {
    id: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    name: 'Steven Jones',
    email: 'steven.jones@test.com',
    accountManager: 'aron.jenkins@test.com',
  },
  {
    id: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    name: 'Philip Roberts',
    email: 'philip.roberts@test.com',
    accountManager: 'rebecca.jones@test.com',
  },
];

const orders = [
  {
    id: '9b1a5173-a54f-4499-b11f-8c11d3ef5d2f',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'PENDING',
    totalAmount: 59.95,
    branchId: 'branch-001',
    comments: 'Rush order',
    createdBy: 'steven.jones@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: 'f084c4d2-7540-4f8a-bf5e-5b26eaedc112',
        productId: 'prod-001',
        productName: 'Product A',
        quantity: 2,
        price: 19.99,
        total: 39.98,
        createdDateTime,
        updatedDateTime,
      },
      {
        id: 'a2614e6e-bf83-4ab7-b835-e268d1a1fc60',
        productId: 'prod-002',
        productName: 'Product B',
        quantity: 1,
        createdDateTime,
        updatedDateTime,
        price: 19.97,
        total: 19.97,
      },
    ],
  },
  {
    id: 'bd3ae9cb-69a5-41c4-beb3-cad3059495de',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'SHIPPED',
    totalAmount: 99.99,
    branchId: 'branch-002',
    createdBy: 'philip.roberts@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '850672d7-d5b8-459e-aacc-bf36a10e77d2',
        productId: 'prod-003',
        productName: 'Product C',
        createdDateTime,
        updatedDateTime,
        quantity: 3,
        price: 33.33,
        total: 99.99,
      },
    ],
  },
  {
    id: '7579f1ed-9025-44d6-8428-c870b068fbac',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'DELIVERED',
    totalAmount: 149.95,
    branchId: 'branch-001',
    comments: 'Gift order',
    createdBy: 'steven.jones@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '829bf07e-86d4-4404-ac51-27c6ee6b28a4',
        productId: 'prod-004',
        productName: 'Product D',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 49.99,
        total: 49.99,
      },
      {
        id: '110282d3-f641-45c7-a820-7e0e948fd143',
        productId: 'prod-005',
        productName: 'Product E',
        quantity: 2,
        createdDateTime,
        updatedDateTime,
        price: 49.98,
        total: 99.96,
      },
    ],
  },
  {
    id: '04501770-c7d4-40bc-962c-e6590dfb3eb6',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'PENDING',
    totalAmount: 249.97,
    branchId: 'branch-003',
    createdBy: 'philip.roberts@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '03df8498-0d51-40a6-a45a-220a424560a3',
        productId: 'prod-006',
        productName: 'Product F',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
      {
        id: '5f800b49-2200-4ccc-a6db-f4c6a2e43005',
        productId: 'prod-007',
        productName: 'Product G',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 49.99,
        total: 49.99,
      },
    ],
  },
  {
    id: '9c155b46-fc6b-432a-80fe-a0d933eaeb30',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'SHIPPED',
    totalAmount: 79.98,
    branchId: 'branch-004',
    comments: 'Bulk order',
    createdBy: 'michael.smith@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '579f0144-0378-4d9a-a52d-a4e0fdfcb24c',
        productId: 'prod-008',
        productName: 'Product H',
        createdDateTime,
        updatedDateTime,
        quantity: 4,
        price: 19.99,
        total: 79.96,
      },
    ],
  },
  {
    id: '026ca08a-51ea-458e-905f-34e7aa626668',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'DELIVERED',
    totalAmount: 149.97,
    branchId: 'branch-001',
    createdBy: 'emily.johnson@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '626c5ea0-652d-40a3-a826-5c8cbc9b0a75',
        productId: 'prod-009',
        productName: 'Product I',
        createdDateTime,
        updatedDateTime,
        quantity: 3,
        price: 49.99,
        total: 149.97,
      },
    ],
  },
  {
    id: '9f7a2e5e-27ca-47c7-872d-5bc57f7fbcd0',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'PENDING',
    totalAmount: 299.96,
    branchId: 'branch-002',
    comments: 'Special order',
    createdBy: 'chris.watkin@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '05959659-c4f4-4135-8868-d4fcda66536c',
        productId: 'prod-010',
        productName: 'Product J',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.98,
        total: 199.96,
      },
      {
        id: 'a9d5e8fa-48a3-41a2-8fa5-eca3ec9aba60',
        productId: 'prod-011',
        productName: 'Product K',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 99.99,
        total: 99.99,
      },
    ],
  },
  {
    id: '57670613-6fd4-4f8e-b479-9336f7ae278a',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'SHIPPED',
    totalAmount: 199.98,
    branchId: 'branch-003',
    createdBy: 'chris.watkin@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '2be60be3-8f36-4fc0-8d9b-4f842280f8b9',
        productId: 'prod-012',
        productName: 'Product L',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
    ],
  },
  {
    id: '9958d895-7aa6-4856-bebf-f024f899c30d',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'DELIVERED',
    totalAmount: 299.97,
    branchId: 'branch-004',
    comments: 'Urgent delivery',
    createdBy: 'emily.johnson@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: 'a1ddf391-5fb2-4157-bda9-e93d07d75601',
        productId: 'prod-013',
        productName: 'Product M',
        createdDateTime,
        updatedDateTime,
        quantity: 3,
        price: 99.99,
        total: 299.97,
      },
    ],
  },
  {
    id: '3eefc250-7560-496c-ac09-ad040f422c02',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'PENDING',
    totalAmount: 149.98,
    branchId: 'branch-001',
    createdBy: 'michael.smith@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: 'cf678e24-56ff-4e6a-9a22-51a2c8a2f909',
        productId: 'prod-014',
        productName: 'Product N',
        createdDateTime,
        updatedDateTime,
        quantity: 3,
        price: 49.99,
        total: 149.97,
      },
    ],
  },
  {
    id: '506edd5d-26d8-4c67-bab2-2453a0428c04',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'SHIPPED',
    totalAmount: 399.96,
    branchId: 'branch-002',
    comments: 'Large order',
    createdBy: 'michael.smith@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: 'd2f84d9f-ed6f-482f-9ed7-1238ee346df0',
        productId: 'prod-015',
        productName: 'Product O',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
      {
        id: '73f4f3fe-1b74-4634-86db-5cc7e2d4994c',
        productId: 'prod-016',
        productName: 'Product P',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
    ],
  },
  {
    id: '7ac2f178-816a-43b2-8285-ce32fa2ef782',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'DELIVERED',
    totalAmount: 99.99,
    branchId: 'branch-003',
    createdBy: 'emily.johnson@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: 'd3e9d540-0a15-4df5-89c2-aaa7aa4d2e1a',
        productId: 'prod-017',
        productName: 'Product Q',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 99.99,
        total: 99.99,
      },
    ],
  },
  {
    id: '4947c18d-5804-48d4-9b66-07309dea1570',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'PENDING',
    totalAmount: 249.97,
    branchId: 'branch-004',
    comments: 'Special request',
    createdBy: 'steven.jones@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '3d645526-21ef-4ca8-a215-0a185e3467db',
        productId: 'prod-018',
        productName: 'Product R',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 99.99,
        total: 99.99,
      },
      {
        id: '48cae7de-3140-41f9-be3b-318bd50fd751',
        productId: 'prod-019',
        productName: 'Product S',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 149.98,
        total: 149.98,
      },
    ],
  },
  {
    id: '7bbbbcac-664b-4cea-85fc-30ca997cd598',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'SHIPPED',
    totalAmount: 199.98,
    branchId: 'branch-001',
    createdBy: 'philip.roberts@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '93c886f1-af75-498e-8f5c-6fc4925fea61',
        productId: 'prod-020',
        productName: 'Product T',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
    ],
  },
  {
    id: '25781bb3-9695-42fe-9560-4032337f8a9e',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'DELIVERED',
    totalAmount: 299.97,
    branchId: 'branch-002',
    comments: 'Urgent order',
    createdBy: 'steven.jones@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '0bed6653-a214-4f8a-8d53-e6db399b9ca7',
        productId: 'prod-021',
        productName: 'Product U',
        createdDateTime,
        updatedDateTime,
        quantity: 3,
        price: 99.99,
        total: 299.97,
      },
    ],
  },
  {
    id: '23f10c67-6835-4ce7-90b3-e69713c98739',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'PENDING',
    totalAmount: 149.98,
    branchId: 'branch-003',
    createdBy: 'philip.roberts@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: 'aa91e53c-b3fa-472b-848f-265a4be093b8',
        productId: 'prod-022',
        productName: 'Product V',
        createdDateTime,
        updatedDateTime,
        quantity: 3,
        price: 49.99,
        total: 149.97,
      },
    ],
  },
  {
    id: 'd05f1bda-2c1c-4638-9765-949a7d7beb8b',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'SHIPPED',
    totalAmount: 399.96,
    branchId: 'branch-004',
    comments: 'Large order',
    createdBy: 'steven.jones@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '2893d8de-72f3-4864-94b8-1c20c70557c0',
        productId: 'prod-023',
        productName: 'Product W',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
      {
        id: 'aaa4667a-ea73-4b74-9565-e102d728ce7b',
        productId: 'prod-024',
        productName: 'Product X',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
    ],
  },
  {
    id: 'a99806c6-5405-4102-90a6-319733c935cc',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'DELIVERED',
    totalAmount: 99.99,
    branchId: 'branch-001',
    createdBy: 'philip.roberts@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '4abd3bea-4ee4-4bc5-9934-0c87af8032c4',
        productId: 'prod-025',
        productName: 'Product Y',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 99.99,
        total: 99.99,
      },
    ],
  },
  {
    id: 'faff19ac-ce49-44f6-872c-3168dcd2cab4',
    customerId: 'c11d3c3d-c414-4516-b0d1-93066be22726',
    customerName: 'Steven Jones', customerEmail: 'steven.jones@test.com',
    customerAccountManager: 'aron.jenkins@test.com',
    status: 'PENDING',
    totalAmount: 249.97,
    branchId: 'branch-002',
    comments: 'Special request',
    createdBy: 'michael.smith@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: '45d0360f-0f12-4545-91b2-6b2482dc6435',
        productId: 'prod-026',
        productName: 'Product Z',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 99.99,
        total: 99.99,
      },
      {
        id: 'f479e1b8-84e3-43bc-ba4e-ff5818da64a6',
        productId: 'prod-027',
        productName: 'Product AA',
        createdDateTime,
        updatedDateTime,
        quantity: 1,
        price: 149.98,
        total: 149.98,
      },
    ],
  },
  {
    id: '01a82277-6cb5-4340-a79e-ebe57ccef67c',
    customerId: 'fda9384e-ddec-4be9-83a0-29056bae94a5',
    customerName: 'Philip Roberts', customerEmail: 'philip.roberts@test.com',
    customerAccountManager: 'rebecca.jones@test.com',
    status: 'SHIPPED',
    totalAmount: 199.98,
    branchId: 'branch-003',
    createdBy: 'emily.johnson@test.com',
    createdDateTime,
    updatedDateTime,
    orderLines: [
      {
        id: 'c614777a-ed38-4e04-8aa5-066921e5124c',
        productId: 'prod-028',
        productName: 'Product AB',
        createdDateTime,
        updatedDateTime,
        quantity: 2,
        price: 99.99,
        total: 199.98,
      },
    ],
  },
];

const tableName = 'OrderTable';
const client = new DynamoDBClient({});

orders.forEach(async order => {
  const orderHead = JSON.parse(JSON.stringify(order));
  delete orderHead.orderLines;
  const items = [
    {
      Put: {
        Item: marshall(
          {
            PK: 'ORDER',
            SK: orderHead.id,
            ...orderHead,
            GSI1_PK: 'CUSTOMER_ID',
            GSI1_SK: orderHead.customerId,
            GSI2_PK: 'CUSTOMER_ACCOUNT_MANAGER',
            GSI2_SK: orderHead.customerAccountManager,
            GSI3_PK: 'CUSTOMER_EMAIL',
            GSI3_SK: orderHead.customerEmail,
            GSI4_PK: 'BRANCH',
            GSI4_SK: orderHead.branchId,
            GSI5_PK: 'CREATED_BY',
            GSI5_SK: orderHead.createdBy,
          },
          { convertClassInstanceToMap: true },
        ),
        TableName: tableName,
      },
    },
  ];

  order.orderLines.forEach(orderLine => {
    items.push({
      Put: {
        Item: marshall(
          {
            PK: 'ORDER_LINE',
            SK: `ORDER_ID#${orderHead.id}#LINE_ID#${orderLine.id}`,
            ...orderLine,
            orderId: orderHead.id,
            GSI1_PK: 'PRODUCT_ID',
            GSI1_SK: orderLine.productId,
            GSI2_PK: 'QUANTITY',
            GSI2_SK: `${orderLine.quantity}`,
            GSI3_PK: 'PRICE',
            GSI3_SK: `${orderLine.price}`,
          },
          { convertClassInstanceToMap: true },
        ),
        TableName: tableName,
      },
    });
  });

  try {
    const transactWriteItemsCommand = new TransactWriteItemsCommand({
      TransactItems: items,
    });
    const response = await client.send(transactWriteItemsCommand);
    console.log('Item inserted successfully:', response);
  } catch (err) {
    console.error('Error inserting item:', err);
  }
});

customers.forEach(async customer => {
  const dateTime = new Date().toISOString();
  const command = new PutItemCommand({
    TableName: tableName,
    Item: marshall({
      PK: 'CUSTOMER',
      SK: customer.id,
      id: customer.id,
      name: customer.name,
      email: customer.email,
      accountManager: customer.accountManager,
      createdDateTime: dateTime,
      updatedDateTime: dateTime,
      GSI1_PK: 'CUSTOMER_NAME',
      GSI1_SK: customer.name,
      GSI2_PK: 'CUSTOMER_EMAIL',
      GSI2_SK: customer.email,
      GSI3_PK: 'ACCOUNT_MANAGER',
      GSI3_SK: customer.accountManager,
    }),
  });

  try {
    const response = await client.send(command);
    console.log('Item inserted successfully:', response);
  } catch (err) {
    console.error('Error inserting item:', err);
  }
});
